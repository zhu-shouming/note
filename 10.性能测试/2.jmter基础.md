#### jmeter基础

##### jmeter环境和配置

- jmeter依赖`jdk1.8`
- 修改语言为中文：修改bin/jmeter.properties文件language=zh_CN，保存并重启jmeter

##### jmeter文件目录

- /bin/：jmeter配置文件、启动文件及默认保存脚本路径
  - jmeter.bat：windows启动文件
  - jmeter.sh：linux启动文件，启动命令sh jmeter
  - ApacheJMeter.tar：通用启动命令java -jar ApacheJMeter.tar
  - templates/：用于生成html报告
- /docs/：api文件，用于jmeter二次开发
- /printable_docs/：jmeter离线帮助文档
- /lib/：源码包文件
  - /ext/：jmeter第三方插件

#### jmeter功能

- 测试计划：脚本的根
  - 线程（用户）
    - 线程组：进行性能场景设计
      - 取样器：根据不同的协议，选择不同的取样器。主要用于编写脚本，发起请求。
      - 逻辑控制器：控制脚本执行逻辑，先于取样器执行。作用范围：子集取样器
      - 前置处理器：
      - 后置处理器：
    - setUp线程组：前置场景
    - tearDown线程组：后置场景
  - 配置元件：`优先级最高`,可置于测试计划下、线程组下、取样器下。相同key值取最近配置元件的value值，不同key值叠加。
  - 监听器：根据不同的维度展示执行的结果
    - 查看结果树：显示http请求的响应

##### 脚本编写注意事项：

1. 当请求体为json格式时，配置元件-请求头中必须添加：`Content-Type=application/json;charset=utf-8`;当请求体为表单格式，默认为`Content-Type=application/x-www-form-urlencoded`

2. 取样器-服务器名或IP不能携带/
3. 当get请求携带参数需带加密的数据，需要在参数重勾选`编码`

4. 如果请求体有中文，请求处的内容编码需添加utf-8

备：请求头中添加charset=utf-8用作控制json格式请求体的内容编码；请求参数编码，表单参数、有非字母/数字都需要勾选，且建议默认勾选；内容编码控制请求体的编码，建议默认填写utf-8。

##### 变量定义

jmeter变量名称遵循java变量名定义规则

变量的引用：`${变量名}`

变量定义的方法：

1. 用户定义变量：全局有效，跨线程组使用
   1. 测试计划里面定义变量
   2. 配置元件中用户定义变量
2. 用户参数--前置处理器
   - 用户参数挂载测试计划下，多个线程组中可引用
   - 挂载在某一个线程组下，当前线程组中可引用，其它线程不能
   - 挂载在某一个取样器下，当前取样器或在取样器之下的取样器可引用，在当前取样器上不能引用

注：测试计划中复选框--》独立运行每个线程组，不勾选表示测试计划下的每个线程组是并行运行，勾选表示线程组从上到下依次运行

##### 函数

jmeter函数（函数名严格区分大小写）分为：

1. 自带函数：Tools->函数助手对话框

   - ${__Random(,,)}：随机数函数

     - **用户定义的变量在使用随机数时，启动脚本的时候生成一个值，运行过程不会动态获取**
     - **用户参数在使用随机数时，不同接口调用用户参数会动态获取，如果想让多个接口使用相同的值，需要：**
       1. **把用户参数放在第一个取样器的子集中**
       2. **勾选用户参数`每次迭代更新一次`复选框**

   - 时间相关函数：

     1. ${__time(,)}：生成时间戳，可格式化时间
     2. ${__timeShift(,,,,)}：时间偏移函数
     3. ${__dateTimeConvert(,,,)}：时间格式转换函数

   - 计数函数

     - ${__counter(,)}：每次只能+1。如果需要使用+2、+3操作，需要使用计数器元件。

   - 加密函数

     - ${__digest(,,,,)}：只能进行简单加密。如果是复杂类型加密，需要code。

     注：1.性能脚本中，不要使用`${__BeanShell(,)}`，它的性能非常差;

     2.写java代码可以使用JSR223元件，对应函数可用`${__jexl3(,)}`或`${__groovy(,)}`。也可以将加密文件的源代码打包成jar文件，放在jmeter的lib\目录下，重启jmeter。不要使用测试计划下引入库功能。

   - 整数的加法运算：${__intSum(,,)}

   - 属性相关函数

2. 扩展函数：需要使用第三方扩展包