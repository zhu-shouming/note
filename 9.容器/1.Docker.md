#### Docker的由来

1. 环境配置问题，用户计算机环境不相同，如何确保软件能正常在不同计算机上运行
2. 虚拟机就是一种带环境安装的一种解决方案，但它资源占用多、冗余步骤多、启动慢
3. Linux容器是linux发展出的一种虚拟化技术，不是模拟一个完整的操作系统，而是对进程进行隔离，它启动块、资源占用少、体积小

#### Docker

- 属于linux容器的一种封装，提供简单易用的容器使用接口。Docker将应用程序与该程序的依赖打包在一个文件里，运行这个文件，就会生成一个虚拟容器。
- 用途
  - 提供一次性的环境
  - 提供弹性的云服务
  - 组件微服务架构

#### image文件

- Docker把应用程序及其依赖，打包在image文件里面

  ```bash
  $ docker image ls	# 列出本机的所有image文件
  $ docker image rm [imageName]	# 删除image文件
  $ docker image pull library/hello-world	# 拉取仓库中library组下名叫hello-world的image文件
  $ docker container run hello-world	# 运行image文件，会生成一个正在运行的容器实例
  $ docker container run -it ubuntu bash	# 运行ubuntu的image提供服务
  $ docker container kill [containID]	# 手动终止容器服务
  ```

  注：可修改docker仓库的地址

#### 容器文件

- image文件生成的容器实例，本身也是一个文件，称为容器文件

  ```bash
  $ docker container ls	# 列出本机正在运行的容器
  $ docker container ls --all	# 列出本机所有容器，包括终止运行的容器
  $ docker container rm [containerID]	# 删除容器文件
  ```

  注：一旦容器生成，同时存在image文件和容器文件。关闭容器并不会删除容器文件，只是停止容器的运行

#### Dockerfile文件

- Dockerfile是一个文本文件，用来配置image。Docker根据Dockerfile生成二进制的image文件

##### 制作自己的Docker容器

1. 编写Dockerfile文件

   - 忽略打包进入image文件

     ```shell
     # 新建文本文件.dockerignore，在文件里填写需要忽略的文件
     ```

   - 项目跟目录下，新建文件文件Dockerfile，内容如下：

     ```shell
     FROM node:8.4	# image文件继承官方的node image，冒号表示标签，这里标签是8.4，即8.4版本的node
     COPY . /app	# 将当前目录下的所有文件（除了.dockerignore排除的路径），都拷贝进入image文件的/app目录
     WORKDIR /app	# 指定接下来的工作路径为/app
     RUN npm install --registry=https://registry.npm.taobao.org	# 在/app目录下，运行npm install命令安装依赖。注意，安装后所有的依赖，都将打包进入image文件
     EXPOSE 3000	# 将容器3000端口暴露出来
     ```

2. 创建image文件

   ```bash
   # docker image build命令创建image文件
   # 	-t参数用来指定 image 文件的名字
   #	后面还可以用冒号指定标签。如果不指定，默认的标签就是latest
   #	最后的那个点表示 Dockerfile 文件所在的路径
   $ docker image build -t docker-test:0.0.1 .
   # 如果运行成功，就会看到新生成的docker-test
   $ docker image ls
   ```

3. 生成容器

   ```bash
   # -p：容器的3000端口映射到本机的8000端口
   # -it：容器的Shell映射到当前的Shell
   # docker-test:0.0.1:image文件的名字（如果有标签，还需要提供标签）
   # /bin/bash：容器启动以后，内部第一个执行的命令。保证用户可以使用shell
   $ docker container run -p 8000:3000 -it docker-test:0.0.1 /bin/bash
   ```

4. 启动服务

   ```bash
   # 创建好容器后可以进入容器手动运行项目
   # 	也可以将运行命名卸载Dockerfile中，容器启动命令自动执行（CMD命令）
   #	指定CMD命令以后，docker container run命令就不能附加命令了（比如前面的/bin/bash），否则它会覆盖CMD命令
   CMD node demos/01.js	# 表示容器运行后自动执行node demos/01.js
   ```

#### 常用命令

```bash
$ docker container start [containerID]	# 启动已经生成、已经停止运行的容器文件
$ docker container stop [containerID]	# 终止容器运行
$ docker container logs [containerID]	# 查看docker容器的输出
$ docker container exec -it [containerID] /bin/bash	# 进入一个正在运行的 docker 容器
$ docker container cp [containID]:[/path/to/file] # 从正在运行的 Docker 容器里面，将文件拷贝到本机
```



